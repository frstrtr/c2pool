#include <gtest/gtest.h>
#include <memory>
#include <vector>
#include <string>

//#include <sharechains/tracker.h>
//#include <networks/network.h>
//
//#include <sharechains/share.h>
//#include <sharechains/share_builder.h>
#include <sharechains/data.h>
#include <libdevcore/random.h>
#include <btclibs/util/strencodings.h>

TEST(SharechainDataTest, TestCheckHashLink)
{
    for (int i = 0; i < 100; i++)
    {
        auto d = c2pool::random::random_bytes(2048);
        auto x = shares::prefix_to_hash_link(d);
        ASSERT_EQ(shares::check_hash_link(x, std::vector<unsigned char>{'\0'}), coind::data::hash256(PackStream(d)));
    }
}

TEST(SharechainDataTest, TestForOneHashLink)
{
    auto d = ParseHex("1a771dd7911edade4d63db5cfda8e7595e29c089580302c4dffb2bf6bbc48e2d1621420932820f43a46e4a452cf9d2e2f281d337eb5e082b114391408a0ad12cb716f4e66327fe751968d6046009b33abd1b91538b9be0261572363deb7b4c2a1eb02e3604e57788b210e6a833177060ab5497b29f8e80eebce8c798baa218823eba857949b634dad92f1b219d9f46526744ecd9dc149412b002270f95e4d20b9427f7b924bdfba1f628a204949b47c4812d7a0cdeaa2990e7ab8f5ae75d6efa1e7729a6a85b4f256055f48a6e14144a0fbe7bc286301fb1f6aa20f31787d0e55245dc609df4ee7fd22c94c5d479e02aa00695d7038806fb35dac826e62607b1c58e8292575ae3b04cb153457b78d0757ac7eb79db9869a1a8b3bf806f904c7bdedf0dbee8ec7a23abeea3f6bed5e638e61298a134c3de88c6e15c4260b52a952c447f707ee278b386fd904025a2ac608dcdb4d9015b865d888c0e8becd93c74350b6f60b78f2299240bd7bdb08858160ae734501a412fffbb0ec5188fef45c3ee9502ada21e8fc41fe244e9b2fa1cd053630d2a07b611489e98414d88a50d1f42477dd531246399816ce89c35276420d37e1665506de3d1aff50166c171e99ac8293fa3e1bb86f247f1e950c75a2293eaf46ee3244a443c277def788df3e5f6d87dbe45b7917fa55f4f959b37567e75e92e4484e40bc6f3b4eefe0c8983bcd2bf7cfc11d4a141c7a1e32f13b1eb52e2e5ce7bff5321c7df68295823b2486718bf3efbc2e48cdff3f3b93ad1c1e165d9145c9556d5f600f09898844b99370919f3b1ab2569aee055ca8a011f4eda7bc493d9157dde1b25b80d2ace3ef6736e7736142c38845aca8186b1fb12cc516a62ae066fe367704f07a144df59822506242b4380a3222a5bef6016309d16984f87432c8c0189588dd5404f24851d433c62b56d513bf4c688c150120e36672c53d9285e05847fe8b2d2b70d04f4ba56e1137849f7e8c81380f30a38d0fae4d81cbb50d9704a45ac84d691743c60475c7082ccb142aa6ced197f35a7acfe29b4c2c514368e81334d26afe31374b33e41bd919c89f333a4f0489e0e96eca7439787288c997574ec5c09d0832b008b520407329e1c60b22ebc014865b243cf67dfb15069ef3af3edd02fcc6233bc4bd8283dd1684c4643f243b7d65d242bae3d617213bfcf295d2fad0b11fb68a0dc1ee97aea03d56fc59592a2ed991c23ee47a19904c77a43b93095ea9a090189a5a81c7e4f848880378d4ce3333e7a7c4d5a9ce04e612241e7eb1dd6c72afd28ee8f1fd1972c8f3cab189ee4090026490a9e41e269297260e932c20a03fce7ee21e3477e5bdab80ad5851814e2ce1b2e8faf087222558806328cbd02727f938599d1322f5179c050db0ee08337000d84063a03f6ac48f950b072b37fe55a2d77a3dac4453518edfc54383dd2a662c35f30d214d7915c482012edf08c1b42c0a90dcf56b9358e2abbd44c276024314f62b33f3482a886f5881d2ac742db27a736bcb087753fdfd5eba4b7d9badb13cef1cbfdafae8b3ff3d86f5150bdd549eb6a3d4fcc31f62d96e9aae8a66b7b398622ffe0a39e8fe87e79f8edb3bcb5f82c5e51cfe68a69897cc60f5ccea4c8160b4885c06b9ae4dd7cba5f0dd89a0b27e5ca38fe121cd551d9f405946086d4b3ab9e5ebb635b28006c66c29a33a59909c276fc5a9b3ce5b0f792890b71e22d9d580dadea5e2aac3d15a98530ba3e64535a1a37b0b6fb02e77f53359dc583cc591c86a25213cbfb99706df4c7ba57f9efcaa043d86951e6343ff24fc7767da5784e9541cfa806d15461370e767dbb954a7b58b1106a161157bf9e5a1a8ca57fbd42d7f9c17fd5562713ef65cd46499e80aa6507873354329b5c2c15b5ddb974138c1686d934c2ebe323e4c3a8d480cca21885dd1fb15565f4d7fef6660d5519842791990f888d81d057c4be40c88c6c993eaafa208cbf0712cf4872b9e36ae744a73b7f4a83471e7f59e72784be17b3d403eb4c3bf385e3c0a9e67a0073d2d2b92d30a9ba5c08cf8e2e8d535f6107a20b0b7c852f84b82675e0a765feac1b41703a9bbfc0c9b0e615915992325ee2d8a0e76d496b75451c39308efead38a96a989e86621e8802a52a707ff8746cff6aec62f45230da1e689cd0ecf662d6faa0c19bb49fe77fa173538bd0502ab2708acb761f662aa4bdcaabc807c08547e5ee7da38ff9826ed2568b3f44aa3d510bd6d4c26530dd12ec2c9389ab94bfc7f26ac5c5fd036e7fa3e90172b6301f91917662a3631cb7bd9d5b135a8b3819ab279ec764e8d59b69bfe7fa697f630dd5d7437ffa848e03f4c0822f7af80bab506f07877d740f449f8de0c374002b79fa370f3c3a6406723591f1f3b412e8fcb8193698cc79103dee2aa11943b98c0d8d5adef453d4bc2d281752e59e3ecebb871bb84ab8709010615b3b66e2af9e769ba5d9adfff79ade63168b1c3497765e09600de8b6e252d5900427e788c83754349839e6973c51ba81570bfeed45207249fe0508193bd9f3c12903012b92c7a252d5efdcddc5fa59c46f7aa376f7aadabe6142d7f39ad2f54d7fd155c672a211915e310ec2af4171eea9dba04f4bfd5c5223ad4ff661384547eb381c7f09cfb1e47f9007f2cd68ba5c7df67d38c6fe9486d5ba6b9c3d438d15e22528aecdf3add0e2c68f7a5a13421130ec07d15d242fadc2fd234d68f36d108e8ff8779bd14baf9296c90d280ce12202bc59785e4811a96f269a0dbbb59d7743a4f74cf0c32374f27e5b1f0d5e0326d2022260b36524f5890f5661d90d44d972bb5929295dc101f1df23b0e75d0167989da027939e7ce9357fc9e221201c9ee42eb8f06d621e0fb7ab53a3036ea6947ed6");
    auto x = shares::prefix_to_hash_link(d);

//    uint32_t init_state[8]{
//            ReadBE32((*x)->state.data() + 0),
//            ReadBE32((*x)->state.data() + 4),
//            ReadBE32((*x)->state.data() + 8),
//            ReadBE32((*x)->state.data() + 12),
//            ReadBE32((*x)->state.data() + 16),
//            ReadBE32((*x)->state.data() + 20),
//            ReadBE32((*x)->state.data() + 24),
//            ReadBE32((*x)->state.data() + 28),
//    };

    ASSERT_EQ(shares::check_hash_link(x, std::vector<unsigned char>{'\0'}), coind::data::hash256(PackStream(d)));

    std::cout << "test" << std::endl;
}

TEST(SharechainDataTest, TestForCustomState)
{
    auto d = ParseHex("c615011e9bc97dfbfe49315758192525ded55c0660a02e75cb9b7f26ab2ff158ffc00580536eaeb322f49494084bd487f3c84047d2fbb737025de2d26f3094111c5941791a91587d60a7fd599a95dd39ab437b23c10f302f4cf459b4df75755638884c454710b901b78e72d5922d336e457039ed6eacafdaf9988f5950c714ebc9ac5eef50990651b8c9c5b660922942bcb4e3651961922aa358dc726dd3f694d2514bbab250d97f6a9b495f62151699144d24dba7f446c1f80e3fe2f4790298c964bdb2198349df3c03f0161e13923709c301b42da0338a1dff246e403cf4eb84ca490f14314c2385059551b8ea4681610b196488b86fa47218821fc8f514e5f90e201c805602d79aa1087f407b667cb8d2d94b713b2c2e998b18e2134777d62943594f6871ff4e62d2b53782ef22c9528363b5c64b1248fb5728e2c7c276e530d1a4c03b240f86efc63f33c05f14da593f8048a41df8521415315f44bc3d897f39f92dc2f4ae78c13615d7b24208f0eb199f8bc13b9a23d271101dcea3e3cc3d4d54e3a40e759bdef8920ef8d8241a2178a3467409a0a840d5fa24bdd786d8c6b518cb2e38b8af60cfe57a6b2e6e1419405ac9cd44513700604c8831a9568fa7fd36b0aa7afd70d6df50a5ad3d61fc5297c53ec9734e5c6aae8fc155ba74d472dac9b8393c86a9ef9cc0332f752964dcbefa77e9d6407620f43a2a115c6ac54ac038f8f774149647dcbd1ff68f4c53e0813a9f57f356bc66876aee2bebb547e65f341129f9b3ea7da85019e03a4e3481f0b53ffba021bf1f5309856802f6e1a4572d82935db67e71008f829dda279511d0f898f441b44000bc989bb957498007525ddcdc4775e84317442a9c378ac03ecdfd92f3f53ba4c06011bbac05522cdef08f0ba2315e60590d8f3fb53a59573c9cac901ad9dd683bd8af9ecd9385c9fb6d6d510e0ff3189221ff071bba1bf3cd9c3e6011a56d51f23e8138833793ad2045c00cf1976dfc7bb3253e7ca053c2074b5529fb1b85466532fdf04018709e4e8ac53a17c5189f9eafe924ef4b5a733ba40260ea0b57366d7d3cc56f6d2283d0ec0981e27648e5e005b3af410dc6c605ccb3c47f1159f6266690ffa2c0bb0834fad1290cc1935f54a5f69371d5bb8fe0160f8b475201d884bc3e21f025b9645ff5c5cec09cae451c67e4b7ff07d17ea2c5105feecacecfe1382a65865c7b07faf106fcf8d3038ca21d38b4ae617a90047cbf7bc53d5d810a02d0134b3176aac8f5a4f83bb06d2fa842e5e968295697b701b84ab2fcc902e3be1049328b9936c42377b8afaac2320647e6d808d0a590d5047979d6bd894304b0965ae00cc793365e55bb14974e07299bf9803c1db27731d2430cd659005bd4c9269b4d15608d4912734dfe7115d50aa900f0b99d848c1d2489b83c7051217e51d4fffa3c4571b064de3fc79e182c101520a4a683118ca7bf30d00396c8b65df97e658fe30bd266741a5379522e19168b0ae83e4673527d6f97db5c749c657926b858daf78c2508d373c210f872362fb2715988cc257f2374c129d433df0844ff7e31fb0369c6bd5cfd4c8ec35ec20c7aeede4c59becd69bdf9378c8e650aeab08de0c0687f23454b504e023844ce8818764ee763f9d34e3f3a56f87647fd16aba9ce3f56c22d8d93ccff9a993c8db314b3f3cbb041890077e8eeba49fa77e0f4723c26fd851b3498a3a4121ceb9ba3f9415b62a547d35532f5745ff7302a44e73c541e92fec8599ef84b6153e006b0f206308f410715da40f94ff368cfb1348620f13ddad30226ad3a5ff7d2ee30430dc508cc58ca5d9ba7d54190c5ff00ccde917b56a7fca3a056fb6404f311b2a30b83e70bfdc9fcd74fcbb11ece84f8ab7b66395ec7291774ea9576d5e030d9ade608ae2406840c5da1dd19ab2c35106e29ec2cc11de0b47faaf27e2551aae61eaac1640850287f142204dc348b80badff445f20ecb01e348cd745b49bcd05fc501269d9ecbc8f6e5686f54bda61bfc8c359959eb1fb70a6758a19ffd8ea16b9cf71c40d12c461b42855c3debbe5f15063eaa16b676c8ff053df3e75a5193df6a8834e1e7e35cb4259374ce100dbea372cb0188ab5b8d7efae9f8639bb842643d727a1ee91558424986f97365af2d03aa008af9ad6d72fdbc5bc21ae32a90c51984767de5eda2528bddf17c9371036f23bdf81a8f492655b8a1cd31ded58c1fb838a1e30005cf32843e6fc293b3d17eb9d5f9ae38af0cf2b8ac5fbcd7c3102721328f8e007b0559e55aef06abaeb37282dce84df324d73b2b8abbfb09f3a4758e9fd7c11cb3676ba3929dddeae793bb2e83269fb8e966f3f31a768bcc9e461e524df88ba0c2721f6433927ac012932e9853cfa4fe5bf06673c49e5b1cf97d80a4a3d79dd8a932574ed5f3b66bfd37f8717ed6c99bc8c3791293e56370500ea946811a82fe352f279067cdb4ee4dd089021a131ce3f696c986fd02efc4bb6d144126ff8bc0df994eae3eea9b07ce7228bbcd612b236f5addee3ef219cd43a81261ad13a84688d153aa9b786375b3e8786228287b5708a874558dfe9eeb0ca68403e7d157c43a7eff97b54c5a6970820d12b77f6dcc3cab10f6d6b5a8a73cb049ff38334101b3c98b6a44a912d882590d8ee5707b3cf583cc8c9674c8762fdcf2167d1497e0f8ccfce18b4520093cacebf427c7251ac9745327c5c155d690b02e01bbbceea8187fee0ddc8c4c7c84290eeef5a93bc55e49ea1b65c39bcc1ede79eb54b23366f3a7615490b6f344392828edce70bc75e6f4c50504eaffac649a4000bd70d58f182eac7c13373aaffa43741ba56b62df4400a9c9dbfa5d8e901e5962dc7d53744b79f906d23234c61b50b77a21177a1821e13f");
//    auto d2 = (unsigned char*)"cad0fafb6ff8adc0e6db893982570ec2f805de3c59cd6ac6f7d909e657f291dbbc1048fdc4413a055bf9200b6dad8708d43004b28bbb8c1cb764b9a40b9bf1c1ddfcea0ad9c0fef42d14bc658099ec265bce86ede9f48191ff5cac5735280ec059b0d9cec0b23f7c94a185b264ac7827722d0041842129665a8fbfeb2a15a615cb386b262465177611f8074ce705e77f861fa170bf5d724552756ef7494e25233e95ddbe2acef0e9b96ecfa8a0c256fd0ec4beaa7e82277aa3b0851fa81a498192e2c53ef9f56f3ce6aa32744b920c95087f0a348c0c45a7fc8f6ad4de54cbb9260774ecba9a85428756610a311780fd57239da1dd81c08d9aee841ddd1308f43819ecfe95ee4a5590c36caf9aeb71f45805613bdba18230734c8c491cd0a1def5afc82137fdb6460bf99a620d43d0155ce65414143be6a1a668eace094e06970846eb3d2b020a66cbfca054cc827c328544b5caa08411730b1085fb9b8f2cb1b847540fac59a828582371484c6a22a974e293db457752cb7244749eaf1606dce97cf203685243fecdd60728a958f0beceeea1e18526e03362ff346da2c3f43d5800b59f6281612984642fb454e67444467d5b463568eae3c6109903f9051f1c0634a28d6a2232a07aae0f6fbb1647546698e85d8534b3839d3dcc4612c8f173cca0f2158be4d801d919e9d3d68f12479c0fe6a960c68875f99898abc094e0ed9e4100194f0e3ef0073be6dc0cc9f28d08b26225cfdca6ced9ecf499374719d75b5d98bfd652bf3e9d5057bc4668d3cd5ced6911fc442043a3a8f5a2e8be32d3ee30352b08718733fd9e3a41bbc54a5ea19b324d2e302f92bcfd0c3b11f3d86ee1395ea214d0b7756a7efd7a8b68425adcd0c0b285e7aa71f3fe7670f1f09277c0c7205f6faac3457753838e2d36bbdda32de28336045a82aab9915bacc6c28351743e1975cad810b3fe8e3b46e30649be06a2278ebfe6431cd861252deec9808a5500ad1586999bae314fcc85613f3fbab4684dc28420dd238363b69324ccd314fcdf88a4703de40a3052ffbcb8afff929705a8a6d44248a80239ac50442cb1123a8ed5cd0b47e953acd49fed7af7e1e554f393b5773195efe07a1452e8422d9773be205f3da719d8076bb20169cab2576a3336d0b0bb4397afcfc0c671bb65b123f268f0124b46853492111e0132e147ce4228a974f982b90f1e78e17cfa4ad304aad18291326029bd88192d03d8e568ecd057f2ef47f1eee4c434b2a0ad6ac69060e0c808cbbe8ad745c278fcdb60c522d0dff13e900412e9bce656f8a5762f2601fbce351702055b51d869442da7f20c5eea3a2054f35074635f2ec2366c03293329d94d3884cb48c7aab560aaf4a2c4b15faf085c433bc0b63cc6916b95b7bc1ad33c4adeac3050123c3363dd101127d41b036490d13e6e691ed732d3bb0fa62a449270af649c1f4f899a552fda96335949be4864c928d6cb237605427ed5282fd6ccfc5eaf3dd266773c41daae44452a4b2c05aab4b858cf6cad6bf5afa49664cbc67afe5fb94d634005832f6ed37c171ddfe574137c6eb90b649d24b6a97741a3a2bbaad50adef52c1709680ffaac05e2c4ee744f87eda2c522da0ffaf34cbabf5da94c7523a7e394b0d05636192afb2a8361e1cdfc17a03d1275e39ecdac3bf6b54d7a89ea5aa66fcd29692c78c79bd8147447f0da7b2ba74c0ce8c7c8510e02d215368351f2d4605e1256794eeb22d5b2ab412673fafcdff6431b7c7300b9e09fe6388560b5c5e97ba12be938872fc413444861d733cb03e8a5685ded8f45f3b5d9eb26a09e692f107b35b9f6ea828128cb5571a3d363fab1d7d4a268f52978cf8bea34209881140ef1018824b5ac2490384e768ab60da43636338dcab799859a661edeee80fec46a6cd055047c2ec0cadaad2620bb5cf1e434302fda99f1dd3f03040eaa50d3b84aa6a10e2c45b8e742a4908963976e84868da5e4644a21607b939d4bba89e48e9e52cd3ace0c7aecdecf97a6130a25f40badac1a2610b9218dc23eeac7f68c138c1e16d302ef4de7c81e2180a98562c00a9a278c77df0b70b21828204de4b43f105d91217a11f2099594af29d5d128254faeef29bb003209a3691777f0cf8041656c874f5819d42804ad4eb215360ad10d74466c188ca2f1d664824ab9f11ef3a9c161e10b83bb769b4d6178eb4f6bb8f1c41da558eb4895968ff55b90b7c7a26353562837cb221286bba1efebba12543eac04edb5c9f455dcd294efa5636a5da4bbaafbf56ea87c78b33fb11e397e55636ad54561f91395a5654c47fd6694c5039c1392c0c82517d386c09edb8ab68d3ac1400d1a8319d0e9c9e858e73e90582663cfb398d660854fcbb58ce606f1acddac4c293da9adad14f247db4d4b6a26d72bdedf5d96de5ecb8e2e25adb9d2007e973ec5e161b1c87a5604b7984e1f9cc8d3a8d6b896e6744ddfa17eedfd97e92dbc489f07dc3d72cba95a86cdda9931f3dbb7cac7895248409bf72509a0cb1b8150307b72dd38143d97b726d4b6b78171a797b317f71db8759dbbc5edd7f82a66c4616299e313931b809d26a013ef1bf2cce7bd4c9f9a28929e7c612f408b498e1e12b7d64739b77b0e746c0a6106025f24346b1611f3e513f2dafd23fbc27192b0537e35074d7a83ce980de9882dd4663572952c12f1a2a465a50bc48601f5f0ad64670bd1a0c3dd13bcb1cb6e60d1d9ee25638b7728173cb08d0b2f5dd0bc1d4a3fbfc52f5509c825767271bbd7545634651e31812a42678f3d61aa5225436ee4b946487923c528666de723e86608f70b6f19d592bc4ec7a2fa4fc0bfbebd7220425c865232eb1a87e25ac264e85b63590cf9df24928830bfa76fe1792d656ee8b302";
//    std::string d3("d24aaf5ada8a4eb350b798f49a4dea9f12660b4302866c4ce4d2ce13d1dc49917ad2d413a92ab8c26eba02c2b54fb4029341bb2785d9bb26708634d390d16bfe9c699b1ce1fb71abd414034c70d5140aed4588084abdfcaba23950bd258b9e69cc8482f10a2242f4b3716e5f194ce0b04182bef95a32e202d05d766743c3ec3ff999d175f94a9a84b959e1395828af37eb7b6e60947e9135d5c47360138f37f8cc7dc5ac049717b930b78bf3620fb8913c2b54c84ca8c6ce17a11a15dea926af91c32d31c61a35bf1d685b00e0fdb27965d34d8235e82bea59b50f182724e229b8cbc36f9d857b9bb988407d50c02c6b080cda4ffd1a3081ec3150e35eeec1ec4ec00feed80191e3615c1beab52d82712e14eee4f369cba0016c31f69d200bedaa39f228aa0e5bc6af1e9f0ea39bbdf72f04ed50de37dea6849e1bf71a797f1080c8c42d2a5f6292c35a4282276c23a6a404109f5983a43eef1fbe16fae09a972fc5e3e4163eed54e1d8538f687851b0ba7f3556ba9dc8a9b08877daee42c4421cf3e0f7c4b12c9f27b32e8dba8e5e7ff8b69ffc3c7e98f9508f3025b62f6ade562e408ceeeb02ac8c105223561f3a75f949253ef609674339230aaa3fa4e2c6749b38b385ef51f8eb58c37794788209e45a7eb105e3df7667a5d18e33c01cdc49fccbcda5ab45d7579a788f350522fbdaaae1d4b13aca1cb2a6aa316d20ab10ad4296d1f5467516b16e2e5bdf46872451ceb3096b090dbdd7f327caae3cf5b465d0921e725bd240085daf721bd4317fa9b154fc28da3bc1bb31ca73fa3854457ceea845048fb144db288c6fde47d29260e5e60c486ae08e5d30e6d27dd3e07516a5d32119e83d28608326ff9a9e255723ac44a811328bc4df4b00356eb6445f7e2eabbf4c619c48562b3ababc366dce18de58be35905770f1e45abc0ed3563f0be8127bec436919cc5aa222f01080b78d158ff0e817e1ab5ccbe38bc7eb71b3c8a01418096fa6bbbc0bdcac4a9014954ed0484f829989da8547680479974e4dc31b897df16963e30975f221c9536cb47060215bc8fa4291989bf3cb1d2db12344900ee4cf52db7cc5d420092227812a4d1ed94074c414c3b2f9b9948f3fe4a98ce15db5ec6e81014b728496f59e43a1b7f3f8c4cfe10ce5df5e4821318dce1a22647a7dc0f86e9eefdcc82731e90f6a2e50970b2968e18d9649539e6873dc1661e6b447025a27504c9453adbdd981360c4adc61c4ffb1b712fdd0ba3c0740ae38214174c33d0ec4a77c1a42bde2e8cab1d92bc40d479c29b4d00c5282dcc3ba25e2b8ff491a583d203aae8fae198781882f8af8141d3931052503c6f9175f7d244d041fa3e9c2bc1bb8dfa1478a0cda860f50f814b5b2bd85d8828e153ba88eefc7fda3773975649197cb11314c071f970fb2bd69fd10d1c127bc06656d2a612db4c96ffa66dd55f02169177a31c8517858b01e6d696c568360b3f2f5bc9e3e22ff0e4d719e6bfc8b22496b8ba15eb9de5dc822f014e89d8c60d9671a4790efed0e06bf17891c4142a8180ff6bdcc7cdfea33832e61ed7e8e969484ad4a477d91513af8a820f0b4b9167a41a5af9d848116d2102db1bf407e20204a74bc7632b8551e3a1b76710eb1f954129b1a6346beb4ac49fdc63d0cf7d937ce52fe09ae639e3618e52d64fad4760a3fb01c36953014a1e22b3ad7f4bd607a354d1c07e98d5baef41a259bcaddb9a01c24b2e88afd325f393eee0704f6726078028681d2bb375755ce2c5ef95aeb5edcbbd4f875552981a9ff82ae57f4398ff831287bc7a89ac1b969a06300e48a6c86adb3bf4d69d6f46574da00ed03e666dc67ec36955b46c6acef5fe2715444cbe7b5b3ef2cc51e022b7cf0110a69e794f247c1d1c0cc3eab9346bfb742dcb0e0cfd9237b25d969f689bbe9d5dc3744b5d94b7ed4b4294413d3ad47a39fc9fe9f32b999670d36d8be30e79ebd32bc13f1d3f26b69857d36e4940f9613a397ddacc3068ec6418bcff58a78931c31f89c13240178bae6162bc10fc9458ca44f175a236e65912d3a5356705db8016ecb3ea1e3feace55bc3abd3ad82b7cd39ddd53df815370838939830a8f484767f28f48b263d0ecd43f1df2c1444583b8499f945ada7dc4d8c1c07471863d62b364f48dc1cf065dc1d6f8785df4d0e721b8876ee043b4cd4370a24e8bc9fca22e688a1146b3bff13378718e8597ab46c76b9090b3236481adcc59f4770a475bc40760b0db3c1eedb6d90409bf9b3885b74797a4f1198018200213b9a24dbe23bf48706fc001fe4b8b48aef8ea8d8ac3517afe6908c46fa977f7a235a5d75b10f1493d7edd7d1f27ea24160385c7df4ce2945261a77a80175bde597132bb42e13d3a3b8471cb5e383a45b0a3807adbea683be17c70e408e79e78d689fc0cad08759e4181cfc955c2444f1674f5d3e41bd686f7caa50f816f6fb32e65e95efb32fe5f7bd22d8f19d268c0c3938b6d324e2277ea926526308797d3d1cd9b0b91bc4405bbfd55e6f91783aee2d116a560be9175ae87ec55c71da52f8d1e1f5695ecc3fab01b0767b252370ae3ab49cfe96f91f22e800f9ca74de519786371267a1d70e68e9853877bc2a39e5dd80cb09f78e8e2283246bae671572acf74839c31d2553582b41a9b0fd2deb7944ff50e129cd2ed4752c8515aeec2cfb4c33ecd43c9aea8ef9026b27397b1df6b69aeebe6f3117f2b89df80ba79c5400569ead4f59e994d8177fefbcca572b9bbcf40759d1f671190412508a6e3dce8a6837d38ec196b8e738d6eb465dc3303345290436e840409c384ecf71b0a1e1981e5ed2d2cc4fdc9c3045675d29477ef0be98460e12f248252286a46269696c11ea986fcd26cfa26f5abd785bfec15f");
//    auto x = shares::prefix_to_hash_link(d);



    //auto sha = CSHA256().Write(d2, strlen((char*)d2));
    auto sha = CSHA256().Write(&d[0], d.size());
    vector<unsigned char> out;
    out.resize(CSHA256::OUTPUT_SIZE);
    WriteBE32((unsigned char *)&out[0], sha.s[0]);
    WriteBE32(&out[0+4], sha.s[1]);
    WriteBE32(&out[0+8], sha.s[2]);
    WriteBE32(&out[0+12], sha.s[3]);
    WriteBE32(&out[0+16], sha.s[4]);
    WriteBE32(&out[0+20], sha.s[5]);
    WriteBE32(&out[0+24], sha.s[6]);
    WriteBE32(&out[0+28], sha.s[7]);

//    sha.Finalize(&out[0]);
    auto hex_hash = HexStr(out);
    ASSERT_EQ(hex_hash, "879387d528687af19a517741752be3ae32b2e472052cba9152e1fa978e3a33e9");

}