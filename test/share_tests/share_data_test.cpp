#include <gtest/gtest.h>
#include <memory>
#include <vector>
#include <string>

//#include <sharechains/tracker.h>
//#include <networks/network.h>
//
//#include <sharechains/share.h>
//#include <sharechains/share_builder.h>
#include <sharechains/data.h>
#include <libdevcore/random.h>
#include <btclibs/util/strencodings.h>

TEST(SharechainDataTest, TestCheckHashLink)
{
    for (int i = 0; i < 100; i++)
    {
        auto d = c2pool::random::random_bytes(2048);
        auto x = shares::prefix_to_hash_link(d);
        ASSERT_EQ(shares::check_hash_link(x, std::vector<unsigned char>{}), coind::data::hash256(PackStream(d)));
    }
}

TEST(SharechainDataTest, TestForOneHashLink)
{
    auto d = ParseHex("2cac3142e0b9ab078f1d8317f4b1817ef98b16f3af87fc9e0c460c60b1b36117f62ad84deca35f912aa2d015743c70d42c913c8fc589218901b5d7eb6a7c2e7c215ac920cd52e7dac7bbfa80602ba9d89148d32d9bdd668ab3bbbdc73b124ea2cf392ba28ce6751363e89af633aa47d4420c0467750a2b3a3a2fcd54d855dbc4bded85c53219968d7a15105a3a70eb66d514d1a90ae334975b915e9080ae6c57acc2391c99ca10f30b55d7a2d3cdc59e00d85f5610e17e2202056ba55cbd8b6f87538290e304b2ff386894754232cd0ca31b238605598007be22c931987a162df49b88ea81fc3c7f170cb2540458b0dd8b87e14a4132f225c41a47a52af8a44be138ab20211d5979853af139955ef30048da78adc63444a650c1d676932ed1467b30e922d9cf3fd8b93202914de274b2ca861f629d851fa1ec2338333d200f212121ed114ee8a434263c6639e759d2735d7db5b38c2c63d88fa0ad2c7400caf672717a7461d49da8e564629785abd625e3fa82681f1a2af71ed0dc477b2c73621fb64f2d5a5df47cec261f06caf611cac2cd425188f0635836433df2f51bd6b794c82c6cff6883bbc291c35c4892cb6e48a98cf27a74508647736c4b3d53c8671ff9cecfe724b14c7133f6dca8ce705625210ac7ad9e15d2b9b2892a31d43c082ca6d0d1e7c5572129fb558868060932ca4d7dfa0773c0f1a54068b362b95e442d1783bbcde1fd61cfe1550004cf6602ee1230dea3a9de6a61d6ce826ab21312f3db1db262d72ce90cbae5e14f5669cde23034f1d4b6f96c0b40772729a411506d7e36fb40fcb1bcf331d18f5b076afdf1f5c5a0e63f02628c7efda4eba8fac2c342709fa74bb9e9a109472f1ab8fad4c9c831351eb0cf42bf080f7837d692b286874f28a60b45dc286d6c5a0eff39072cbb644b53f75b972aa5b460d93113437e612714168f7f99fbfa1a6b5ccc1f8df249133b0f0927e5f4f5d3c5c285ed2a2a186aaf1c89153fbcc4297875b23ecc770d0368652c4a621f0e6613fd118269b48af44f903d7b3bf49ea1c602b19a215bfffe9a16200809644805af57307bce62d927abc97edbf17112a1505ac548e9ad66850bd2d8f54d4cd8a25d9bcfc674da01e3b2852855295d7786f067198cbe698b70afd3e6fc224a9104e4756a4936300e9c36ec0bb583af01596c82ed8af195ac7b220af074d3c45fd92915087639f628e16d582812eb928b6b6d078c1b8d679bf6edeacc04f443f4d3d1010a473d798802104ae2081a4ee65e028d213dee761ad5b164ad6c13f295a04f3fdea6133b1d4f62d7fc1051f660c52674a9d9d5e93ed5b76f2043c46ce9bc135884372196abc4c3e7f500745e8aa79eb1c8de8bce89b92b50d408c88315fac94fb3b877f7d3c3bf660d6e26703fb42445b2a0fab511efbf2c27c45e4ebb239c1abfde411e8b1fee201e98b82efb7ca5f703c083a502864e1a97e9428baf4d934c2483521de5a45d22a980068deb0d6bb484a1b2a5d6ecc058b281a40351f96dba9f75956f86df449f639742f35c66b645310690fabc5cb0b62238648e0c023fbeade78484a7430df250199badf6d21dcdb18d85af33e2ec0e46f5b0471ee8eb39c6cea0e24ef61c733ff841b4985671cbd9766834da273de5ec868b649d18bfc191a0d81e746b472a2252861727819ec25592b2364d9a1304e22e8b23b9590400bc2f2c37d5a6265e033caab8111c08157290fbc8ae058067afc93d003fb1d352f69954b01266d1e3837424b2bf0821bc843c88d699f65cc5dfce03044de960ce2402d220a28deb6572821f6f4d067b5c383e7737dfcd447474414569c50b56aa11f6751dcc6ff0e42ca896b3991a6e5bad742f57eccea802b8b860f4e963f0252212aaa03891cdd903b7f652c41054cef946d1a43f6098072315a26897dcb2e18a53aea2047bc144ee3e54c7ee1a95e35ecc6ba07b7d75fb23d13fe68da5fea291311f6f13495e6d6bde3a22e45cd3901c5d997a88689d8a1de48196b4cbe15b149af7368624eb477fd828bcfca2450824bf9088661e76c1b0349945d982c9346256014095cd16803da9e2faa1caf0864ff67deaa4c626198bacc5dab56b0bf52641a901bafa1a1a7f16620ba4effc5924e1934ec65787d0d2f800043a8ba44ba05abc88adee767fa75b6eda88736fa3a03e5e7cea4919f3de67cc7909b4bd6335dcd0abb5af8eca799c377d51270c3e6705fd37d959f74a241fd7615dc5626302f3d1b83701f79fbd020f237c526e5345571478171a20427e83ce84ef04d8ea29c7e2a62e7f9cdae2eb4cd16af0f6c5baea9078ab5e8040617eb4fd0f79c6dff01b56066a020b835bc3381aa8757444623dda6d6c82a05562d4fa9b991a5ed63f12bd303dc8bdf86767b6abb83afedfe9c35dc4e519310cf19b263bb4ee2ff3b8558ffb23a73e489fa93f81ad54654dae6d9bd91c4c7c78b5c669c3e83c6de6c74d6ef12cc04b77e11b0ef887c9f06edab0e3d727295a60596b580e5ccd210c64d79d2c926bb093a268337a4281089838cf67b121e751e943db3be2964094d14451e70eec13abe217b61755bf0482b05ebfe0dd981cc41e299212a98ddc3c340b6958c7b093b97dd917c0c4ac7d08663dc1c392bbca238a34c2c4fadcba9a818ca0ba85c74899190ad1ab3c145d3cb2edf2ce73ddf19c9be7bb569a6137cd5e8892047da64db78a4631a08d4d9268f1088cfd9c707c4822ec8f92cf0299fd4db7fb2a939ad2172fbcadd8852c45332b061c93000954e9ebe49db892ef42c11b9ba1a845ea7e6d429d554c4caf961bad5b8a526bfb89322256dff206cef24624927d99d3cb121324236319a95665eaf48d41e8b36a4c4a092dffde30799ab281c1c6ef");
//    auto d2 = (unsigned char*)"cad0fafb6ff8adc0e6db893982570ec2f805de3c59cd6ac6f7d909e657f291dbbc1048fdc4413a055bf9200b6dad8708d43004b28bbb8c1cb764b9a40b9bf1c1ddfcea0ad9c0fef42d14bc658099ec265bce86ede9f48191ff5cac5735280ec059b0d9cec0b23f7c94a185b264ac7827722d0041842129665a8fbfeb2a15a615cb386b262465177611f8074ce705e77f861fa170bf5d724552756ef7494e25233e95ddbe2acef0e9b96ecfa8a0c256fd0ec4beaa7e82277aa3b0851fa81a498192e2c53ef9f56f3ce6aa32744b920c95087f0a348c0c45a7fc8f6ad4de54cbb9260774ecba9a85428756610a311780fd57239da1dd81c08d9aee841ddd1308f43819ecfe95ee4a5590c36caf9aeb71f45805613bdba18230734c8c491cd0a1def5afc82137fdb6460bf99a620d43d0155ce65414143be6a1a668eace094e06970846eb3d2b020a66cbfca054cc827c328544b5caa08411730b1085fb9b8f2cb1b847540fac59a828582371484c6a22a974e293db457752cb7244749eaf1606dce97cf203685243fecdd60728a958f0beceeea1e18526e03362ff346da2c3f43d5800b59f6281612984642fb454e67444467d5b463568eae3c6109903f9051f1c0634a28d6a2232a07aae0f6fbb1647546698e85d8534b3839d3dcc4612c8f173cca0f2158be4d801d919e9d3d68f12479c0fe6a960c68875f99898abc094e0ed9e4100194f0e3ef0073be6dc0cc9f28d08b26225cfdca6ced9ecf499374719d75b5d98bfd652bf3e9d5057bc4668d3cd5ced6911fc442043a3a8f5a2e8be32d3ee30352b08718733fd9e3a41bbc54a5ea19b324d2e302f92bcfd0c3b11f3d86ee1395ea214d0b7756a7efd7a8b68425adcd0c0b285e7aa71f3fe7670f1f09277c0c7205f6faac3457753838e2d36bbdda32de28336045a82aab9915bacc6c28351743e1975cad810b3fe8e3b46e30649be06a2278ebfe6431cd861252deec9808a5500ad1586999bae314fcc85613f3fbab4684dc28420dd238363b69324ccd314fcdf88a4703de40a3052ffbcb8afff929705a8a6d44248a80239ac50442cb1123a8ed5cd0b47e953acd49fed7af7e1e554f393b5773195efe07a1452e8422d9773be205f3da719d8076bb20169cab2576a3336d0b0bb4397afcfc0c671bb65b123f268f0124b46853492111e0132e147ce4228a974f982b90f1e78e17cfa4ad304aad18291326029bd88192d03d8e568ecd057f2ef47f1eee4c434b2a0ad6ac69060e0c808cbbe8ad745c278fcdb60c522d0dff13e900412e9bce656f8a5762f2601fbce351702055b51d869442da7f20c5eea3a2054f35074635f2ec2366c03293329d94d3884cb48c7aab560aaf4a2c4b15faf085c433bc0b63cc6916b95b7bc1ad33c4adeac3050123c3363dd101127d41b036490d13e6e691ed732d3bb0fa62a449270af649c1f4f899a552fda96335949be4864c928d6cb237605427ed5282fd6ccfc5eaf3dd266773c41daae44452a4b2c05aab4b858cf6cad6bf5afa49664cbc67afe5fb94d634005832f6ed37c171ddfe574137c6eb90b649d24b6a97741a3a2bbaad50adef52c1709680ffaac05e2c4ee744f87eda2c522da0ffaf34cbabf5da94c7523a7e394b0d05636192afb2a8361e1cdfc17a03d1275e39ecdac3bf6b54d7a89ea5aa66fcd29692c78c79bd8147447f0da7b2ba74c0ce8c7c8510e02d215368351f2d4605e1256794eeb22d5b2ab412673fafcdff6431b7c7300b9e09fe6388560b5c5e97ba12be938872fc413444861d733cb03e8a5685ded8f45f3b5d9eb26a09e692f107b35b9f6ea828128cb5571a3d363fab1d7d4a268f52978cf8bea34209881140ef1018824b5ac2490384e768ab60da43636338dcab799859a661edeee80fec46a6cd055047c2ec0cadaad2620bb5cf1e434302fda99f1dd3f03040eaa50d3b84aa6a10e2c45b8e742a4908963976e84868da5e4644a21607b939d4bba89e48e9e52cd3ace0c7aecdecf97a6130a25f40badac1a2610b9218dc23eeac7f68c138c1e16d302ef4de7c81e2180a98562c00a9a278c77df0b70b21828204de4b43f105d91217a11f2099594af29d5d128254faeef29bb003209a3691777f0cf8041656c874f5819d42804ad4eb215360ad10d74466c188ca2f1d664824ab9f11ef3a9c161e10b83bb769b4d6178eb4f6bb8f1c41da558eb4895968ff55b90b7c7a26353562837cb221286bba1efebba12543eac04edb5c9f455dcd294efa5636a5da4bbaafbf56ea87c78b33fb11e397e55636ad54561f91395a5654c47fd6694c5039c1392c0c82517d386c09edb8ab68d3ac1400d1a8319d0e9c9e858e73e90582663cfb398d660854fcbb58ce606f1acddac4c293da9adad14f247db4d4b6a26d72bdedf5d96de5ecb8e2e25adb9d2007e973ec5e161b1c87a5604b7984e1f9cc8d3a8d6b896e6744ddfa17eedfd97e92dbc489f07dc3d72cba95a86cdda9931f3dbb7cac7895248409bf72509a0cb1b8150307b72dd38143d97b726d4b6b78171a797b317f71db8759dbbc5edd7f82a66c4616299e313931b809d26a013ef1bf2cce7bd4c9f9a28929e7c612f408b498e1e12b7d64739b77b0e746c0a6106025f24346b1611f3e513f2dafd23fbc27192b0537e35074d7a83ce980de9882dd4663572952c12f1a2a465a50bc48601f5f0ad64670bd1a0c3dd13bcb1cb6e60d1d9ee25638b7728173cb08d0b2f5dd0bc1d4a3fbfc52f5509c825767271bbd7545634651e31812a42678f3d61aa5225436ee4b946487923c528666de723e86608f70b6f19d592bc4ec7a2fa4fc0bfbebd7220425c865232eb1a87e25ac264e85b63590cf9df24928830bfa76fe1792d656ee8b302";
    std::string d3("1aa3df631bd4e9db30f1f47499d3a99294d8fe37a15cca328cc160fd3718f765408bbe57430a9c7529d065cc93d2763de72905466c45598a77cbea2281c73ec0ec4a3aa50e1e483e4a552078e4e2ace81580737831f50e0d4c285a6c4552c3943905c9a9d28f057b951c006bf4b9681e824f42f31c512dba7fd0714581679cd23ede5bac08ea04217028d5dce22f61b41ee8050e13c3361a0505b0c0c4e8180f82664c6a7247ccb57865bf8df0bcddc27f59e6fbd353a0453f171b06f942586b21c17beadeb0c75a6d1bb2d23492b45fcb218da2cadc5e166a57c90bfd9afe45fff279c26d1f9b1805451f9855d7a33b1fc76bc8df39a82fac9f50a7cb30235e8a01b9be60b7b9430bf2b39601dc989eac9aaa9a9f697640666c40f9b7ff24accae656e23ffcea68ae69c27099494cb98af8a4f113162082e435a07dc53e7157ebaaf637377995409e5f64c19e99bafe9dfc3d1752da989e67bb74450f024041ab0130d9146b159f4c25199ae26dd39ffbaf9d6d90893e1e9df45e8d2f3f54462141d4ad61715c23a220bd2eb43ab942521c73abf69bf1adcad280d4f01130c8fa57c754272c363da7dd41d15362b3eaf63674b4eb36d9f75bade5325bf711fff17b7681ccd121c2db96c10581103858837cc9b142f3f2694b9d83f3e9bc44fb212d83df70fa161914ce5aa2bd17f2a33ea006b4e038d33c861569ddaf8c7eb7c4bb5bd7de7d87f41f7ac1653e7c026fed0600469a9e6fdfe735c353fddd931859db966ad062213c11513d537489799b7cace4d6db5ea2e5a4af32c2cedffb6fbdf776883a9a51e545a6186aae616c5bbf167b9a1389914cedea1f094d64f9a43dc479089cf476978fc23469025bfd6349f52ddb067b6e4813172cc04f67850b239e292610118881cf62aa703f4390a0070e5afdfdde20980e81e4cd149fe179f8d2f7e6ab04ddbd9fa7dc1a0c84d7676f7303b17aa71e2d94b4c2f981c9180b3772de82f333d5b4797f0812f5344735bdb090a50bce7b60ff22c642f89e1c089249ce60e5a451e77728ff78297e55ae29098ab0010ce6a9fa86464ecc39f1aef077fe42431fcc31cf91eeff08ebd11ac298e39053c72818cda29e8f979f92c24d849fca5a8b5553184db6f4f00319232d86a314dc07b63d55d30a71a05ac86e23ead2ca6f0daa4f91f858a9f274bcf4a6a7d7d88a0d42ac744a648e4e6285b2780705e369d42b0f7fbd22ebefa337c284bcadd4885f062b3868a6fc24168975fb4d787e8b73739a40cee9cc3f1070ba56686c4ec04af4a7dab014797bfec9a53d31c0321727db670c939e0a6718c0ab71fc208d41322cc1232b5d21c0c40ae29eb6034cc80a20b81721b76809ca915819b95faf67b142c5cba52560afd65a912f600c3cdd544ba428168336c8f09273ca42a0844de7725c9d2930706721d053b1afc0a4a2378a52ca55f01888014ed9745792bb66eb7ece85b2e018d8d34c01419dc0eba72ae1c203984f9a5ad1abaae623c5703768c5f08a28911726bc64c1da2da5c19dc0592e9647a649aedb93da5b6830e11eb6a7899f4bd4971ad2d10c8726d36f7b6503e3c1b1942ed5286c2f1bdf3a6d430f5fa921896bde14acb9835a2c3616d2f296af5d78ea1eb5b389f08bf5715bb581b049935625e4cf1f0cb50a517d0b29fed4aac5cee8e3f2225d8a2fd90ef606601b8eadb0f03cdaa5733bc0f224738f957b691c65ddff404e583778e138b96bab52b25072bf300757166490cd043ca50421dd48a44f136560ae0dbd4a8ad44bb472124700dc8dc8c7f362e4d6945b468335054656c92935890f50b3ed5e95ab0662ced0b0a944f40e0d2d9ceae3d718d636cb261f8a4de196232afdf6d909b5e8af6107c4c61c8d470a7cac42b4e9d8b8b9492f454d16fc8b1d6c8e9d8fb8222c73a11a846bea6bd2a850cb744673211a3fe25f2a5aab7b4c08497fc1113e17f1f6772fc897fbff8b95dabc9dbc43dcedea0bfa675ea97475979fdd6e50e7d5a3b1471e51bdee964aea58492e9195279b97808c011e4b22c4acf5b8adacb51940cc7c4b031fecf0d8b5532a4c43ba27665c1fa05c5ff35e14db2669f1a6a69dae2404d8138aeb34406dc1a04b8d1d98f63c9c40f52fa1ddcfe58b627b167bf85797a015843a3dd8c5d00bcfebefbc710c867261993ff796ac10ba8b941e8afa07481c1e83a8d59c05f3ee1d5e8a499546b10f210e2ecac864c5f802c70b6333f3052aad499df90e3ef027d5feb45ffd5a23bc6e70409e3e8c3ad4aa59e1442ba5e2ee3cad8a03c5c0bc724a1696ea567ba72d2e22764108eef7cce000457af38677594996909aca72c7680b9a8ad02e0f72156d8852dd8267942c5720e8ed3f6d49481790541cd89dc7893c1a97b73b8a967c7d42969177fe0ca7d515dae29ba2e3cd266cddfee8438e736ea8cd83f0b61874c8a39980eb0e39ce59c27c9738582bacd9728d3af8339615867d297b3eaa817e3cfe886c0c0a37d411bb08a0c944ac4ecebfe8167f12850d259f99e2ae4a9dbd95db808b22cff9ff69af40781ee381a4e988c8a16b3c546e4c5b313076d5cd6c5045425bc3750c78f13141c034a6b35af88e34e02a0fbf6e42b3358d136df652d16505f6e34867f6ae5c88c9ace0ae45c0520fef27c113f4fb6173a52087f8a75200980cdeefa64c26e33e03e57b88da7db6e061eaa8bb890445a52d94f580536e74e3de7f227cc7e1622c5621dbb180e8406dc30d6921db2936f6a43e9c17c3ed08917ba48ca67aa16e02ac4348445326d91a1e13ddad7eebe545ddd626831e6914032913fd3e1130e447ced5d1028c1f3059f5f79e94837ed379d5cf470d8a232b2088ff24dd248939ee98f8cfce8eed5ddff78f2e89dc");
//    auto x = shares::prefix_to_hash_link(d);


    //auto sha = CSHA256().Write(d2, strlen((char*)d2));
    auto sha = CSHA256().Write((unsigned char *)&d3[0], d3.size());
    vector<unsigned char> out;
    out.resize(CSHA256::OUTPUT_SIZE);
//    WriteBE32((unsigned char *)&out[0], sha.s[0]);
//    WriteBE32(&out[0+4], sha.s[1]);
//    WriteBE32(&out[0+8], sha.s[2]);
//    WriteBE32(&out[0+12], sha.s[3]);
//    WriteBE32(&out[0+16], sha.s[4]);
//    WriteBE32(&out[0+20], sha.s[5]);
//    WriteBE32(&out[0+24], sha.s[6]);
//    WriteBE32(&out[0+28], sha.s[7]);

    sha.Finalize(&out[0]);
    auto hex_hash = HexStr(out);

    std::cout << "test";

}