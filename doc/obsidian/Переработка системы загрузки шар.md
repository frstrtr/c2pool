###### 1. Создать класс DownloadShareManager.
###### 2. Подписаться на изменения desired_val
В объекте класса DownloadShareManager подписаться методом start() на изменения desired_var.
```cpp
void start(std::vector<std::tuple<NetAddress, uint256>> new_value)
{
	if (new_value.size() != 0)
		request_shares();
}
```

###### 3. Запрос шар
Запрос реализован через QueryDeferrer, находящийся в PoolProtocol, с заданными параметрами, рассчитаными в request_shares(...)
- В QueryDeferrer передаётся метод запроса шар.
- В QueryDeferrer передаётся timeout функция.
- У QueryDeferrer отлавливается ошибка, полученная в функции запроса шар.
- В QueryDeferrer вызывается got_response(), обрабатывающий ответ запросу.

###### 4. Вызывается handle_shares из got_response()
Сначала подготавливается набор шар:
```cpp
HandleSharesData _shares;  
for (auto& _share : shares)  
{  
    _shares.add(_share, {});  
}
```
После чего обрабатывается handle_shares:
```cpp
_node->handle_shares(_shares, peer->get_addr());
```
