import coind_data
import pack
import data


def bytes_to_data(bytes):
    res = b''
    for x in bytes:
        res += chr(x)
    return res #str(res).replace(', ', ' ')

# gentx: (TxType: 
#   version = 1, 
#   tx_ins = 
#   [ 
#       (TxInType: 
#           previous_output = (
#               PreviousOutput: 
#                   hash = 0000000000000000000000000000000000000000000000000000000000000000,
#                   index = 0
#           ),
#           script = [ 4, 107, 0, 1, 1, 0, ],
#           sequence = 0
#       ), 
#   ],
#   tx_outs = 
#   [ 
#       (TxOutType: 
#           value = 0,
#           script = [ 106, 36, 170, 33, 169, 237, 187, 117, 140, 118, 145, 50, 60, 13, 218, 56, 40, 217, 74, 151, 175, 237, 167, 155, 73, 146, 219, 156, 217, 128, 177, 105, 168, 17, 140, 70, 208, 229, ]
#       ),
#       (TxOutType: 
#           value = 203120876,
#           script = [ 118, 169, 20, 208, 230, 206, 121, 50, 250, 194, 135, 15, 183, 85, 220, 74, 170, 149, 134, 122, 214, 236, 120, 136, 172, ]
#       ), 
#       (TxOutType: 
#           value = 40421054449, 
#           script = [ 82, 33, 3, 138, 184, 47, 58, 79, 86, 156, 69, 113, 196, 131, 213, 103, 41, 232, 51, 153, 121, 91, 173, 179, 40, 33, 202, 182, 77, 4, 231, 181, 209, 6, 134, 65, 4, 255, 208, 61, 228, 74, 110, 17, 185, 145, 127, 58, 41, 249, 68, 50, 131, 217, 135, 28, 157, 116, 62, 243, 13, 94, 221, 205, 55, 9, 75, 100, 209, 179, 216, 9, 4, 150, 181, 50, 86, 120, 107, 245, 200, 41, 50, 236, 35, 195, 183, 77, 159, 5, 166, 249, 90, 139, 85, 41, 53, 38, 86, 102, 75, 65, 4, 87, 163, 55, 184, 101, 87, 245, 177, 92, 148, 84, 74, 210, 103, 249, 106, 88, 45, 194, 185, 30, 104, 115, 150, 143, 247, 186, 23, 79, 218, 104, 116, 175, 151, 156, 217, 175, 65, 236, 32, 50, 223, 223, 214, 88, 123, 229, 177, 74, 67, 85, 84, 109, 84, 19, 136, 195, 241, 85, 90, 103, 209, 28, 45, 83, 174, ]
#       ), 
#       (TxOutType: 
#           value = 0, 
#           script = [ 106, 40, 222, 189, 100, 181, 44, 35, 214, 220, 224, 181, 107, 253, 35, 48, 172, 182, 14, 96, 175, 183, 205, 252, 123, 12, 77, 41, 74, 44, 104, 20, 66, 196, 0, 0, 0, 0, 0, 0, 0, 0, ]
#       ),
#   ],
#   lock_time = 0,
#   wdata = 
#       (WitnessTransactionData: 
#           marker = 0, 
#           flag = 1, 
#           witness = [ 
#               [ 
#                   [ 91 67 50 80 111 111 108 93 91 67 50 80 111 111 108 93 91 67 50 80 111 111 108 93 91 67 50 80 111 111 108 93 ]
#               ]
#           ]
#       )
# )

gentx = dict(
        version = 1,
        tx_ins = [
            dict(
                previous_output = dict(
                    hash = int('0000000000000000000000000000000000000000000000000000000000000000', 16),
                    index = 0
                ),
                script = bytes_to_data([4, 107, 0, 1, 1, 0]),
                sequence = None
            )
        ],
        tx_outs = [
            dict(
                value = 0,
                script = bytes_to_data([106, 36, 170, 33, 169, 237, 187, 117, 140, 118, 145, 50, 60, 13, 218, 56, 40, 217, 74, 151, 175, 237, 167, 155, 73, 146, 219, 156, 217, 128, 177, 105, 168, 17, 140, 70, 208, 229])
            ),
            dict(
                value = 203120876,
                script = bytes_to_data([118, 169, 20, 208, 230, 206, 121, 50, 250, 194, 135, 15, 183, 85, 220, 74, 170, 149, 134, 122, 214, 236, 120, 136, 172])
            ),
            dict(
                value = 40421054449,
                script = bytes_to_data([82, 33, 3, 138, 184, 47, 58, 79, 86, 156, 69, 113, 196, 131, 213, 103, 41, 232, 51, 153, 121, 91, 173, 179, 40, 33, 202, 182, 77, 4, 231, 181, 209, 6, 134, 65, 4, 255, 208, 61, 228, 74, 110, 17, 185, 145, 127, 58, 41, 249, 68, 50, 131, 217, 135, 28, 157, 116, 62, 243, 13, 94, 221, 205, 55, 9, 75, 100, 209, 179, 216, 9, 4, 150, 181, 50, 86, 120, 107, 245, 200, 41, 50, 236, 35, 195, 183, 77, 159, 5, 166, 249, 90, 139, 85, 41, 53, 38, 86, 102, 75, 65, 4, 87, 163, 55, 184, 101, 87, 245, 177, 92, 148, 84, 74, 210, 103, 249, 106, 88, 45, 194, 185, 30, 104, 115, 150, 143, 247, 186, 23, 79, 218, 104, 116, 175, 151, 156, 217, 175, 65, 236, 32, 50, 223, 223, 214, 88, 123, 229, 177, 74, 67, 85, 84, 109, 84, 19, 136, 195, 241, 85, 90, 103, 209, 28, 45, 83, 174])
            ),
            dict(
                value = 0,
                script = bytes_to_data([106, 40, 222, 189, 100, 181, 44, 35, 214, 220, 224, 181, 107, 253, 35, 48, 172, 182, 14, 96, 175, 183, 205, 252, 123, 12, 77, 41, 74, 44, 104, 20, 66, 196, 0, 0, 0, 0, 0, 0, 0, 0])
            )
        ],
        lock_time = 0,
        marker = 0,
        flag = 1,
        witness = [[bytes_to_data([91, 67, 50, 80, 111, 111, 108, 93, 91, 67, 50, 80, 111, 111, 108, 93, 91, 67, 50, 80, 111, 111, 108, 93, 91, 67, 50, 80, 111, 111, 108, 93])]]
    )

DONATION_SCRIPT = '5221038ab82f3a4f569c4571c483d56729e83399795badb32821cab64d04e7b5d106864104ffd03de44a6e11b9917f3a29f9443283d9871c9d743ef30d5eddcd37094b64d1b3d8090496b53256786bf5c82932ec23c3b74d9f05a6f95a8b5529352656664b410457a337b86557f5b15c94544ad267f96a582dc2b91e6873968ff7ba174fda6874af979cd9af41ec2032dfdfd6587be5b14a4355546d541388c3f1555a67d11c2d53ae'.decode('hex')
gentx_before_refhash = pack.VarStrType().pack(DONATION_SCRIPT) + pack.IntType(64).pack(0) + pack.VarStrType().pack('\x6a\x28' + pack.IntType(256).pack(0) + pack.IntType(64).pack(0))[:3]

print([ord(x) for x in gentx_before_refhash])
print([ord(x) for x in gentx_before_refhash] == [169, 82, 33, 3, 138, 184, 47, 58, 79, 86, 156, 69, 113, 196, 131, 213, 103, 41, 232, 51, 153, 121, 91, 173, 179, 40, 33, 202, 182, 77, 4, 231, 181, 209, 6, 134, 65, 4, 255, 208, 61, 228, 74, 110, 17, 185, 145, 127, 58, 41, 249, 68, 50, 131, 217, 135, 28, 157, 116, 62, 243, 13, 94, 221, 205, 55, 9, 75, 100, 209, 179, 216, 9, 4, 150, 181, 50, 86, 120, 107, 245, 200, 41, 50, 236, 35, 195, 183, 77, 159, 5, 166, 249, 90, 139, 85, 41, 53, 38, 86, 102, 75, 65, 4, 87, 163, 55, 184, 101, 87, 245, 177, 92, 148, 84, 74, 210, 103, 249, 106, 88, 45, 194, 185, 30, 104, 115, 150, 143, 247, 186, 23, 79, 218, 104, 116, 175, 151, 156, 217, 175, 65, 236, 32, 50, 223, 223, 214, 88, 123, 229, 177, 74, 67, 85, 84, 109, 84, 19, 136, 195, 241, 85, 90, 103, 209, 28, 45, 83, 174, 0, 0, 0, 0, 0, 0, 0, 0, 42, 106, 40])

hash_link=data.prefix_to_hash_link(coind_data.tx_id_type.pack(gentx)[:-32-8-4], gentx_before_refhash)
print(hash_link)